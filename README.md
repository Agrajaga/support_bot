# Боты техподдержки для платформ Телеграмм и ВК

Примеры чат-ботов для демонстрации возможностей использования облачной нейросети DialogFlow от Google (https://cloud.google.com/dialogflow) для работы чат-ботов как первой линии техподдержки.
![demo_tg_bot](https://user-images.githubusercontent.com/22379662/184510051-ee39583a-4bf6-4d81-aa87-3d0d0f3d7a1f.gif)

С демонстрационными чат-ботами можно пообщаться по адресам: https://t.me/agrajag_log_bot и https://vk.com/public215288979

## Установка и использование
1. Необходим установленный `python3`. Установите все зависимости командой:
    ```
    pip install -r requirements.txt
    ```
1. Создайте файл `.env` и поместите в него ключи:
    ```
    TG_BOT_TOKEN=<Ваш токен бота Телеграм>
    VK_BOT_TOKEN=<Ваш токен бота ВКонтакте>
    DIALOGFLOW_PROJECT_ID=<ID проекта DialogFlow>
    GOOGLE_APPLICATION_CREDENTIALS=<Путь к JSON файлу с ключем доступа>
    TG_ADMIN_ID=<ID пользователя Телеграм, он будет получать сообщения об ошибках>
    ```
    *Подробнее*:  
    * `TG_BOT_TOKEN` получать у [Отца Ботов](https://t.me/BotFather)
    * `TG_ADMIN_ID` свой ID можно получить у бота [@userinfobot](https://t.me/userinfobot)

    * `VK_BOT_TOKEN` - ключ доступа API
        - Создать свое сообщество в ВКонтакте
        - В пункте `Управление` выбрать `Работа с API`
        - Включите `Long Poll API` с типами события: Входящие сообщения
        - Создайте ключ доступа с правами: сообщения сообщества   

    * `DIALOGFLOW_PROJECT_ID` - ID Вашего проекта DialogFlow
        - Создайте агента по адресу https://dialogflow.cloud.google.com
        - В настройках агента будет пункт `Project ID` он нам и нужен
        - Подробнее о создании агента DialogFlow https://cloud.google.com/dialogflow/es/docs/quick/build-agent

    * `GOOGLE_APPLICATION_CREDENTIALS` получите JSON файл с ключем доступа по инструкции https://cloud.google.com/docs/authentication/getting-started
        
1. Для обучения агента DialogFlow можно использовать скрипт `teach_bot.py`.     
    ```
    python teach_bot.py json_filename
    ```
    Формат JSON-файла
    ```json
    {
        "Устройство на работу": {
            "questions": [
                "Как устроиться к вам на работу?",
                "Как устроиться к вам?",
                "Как работать у вас?",
                "Хочу работать у вас",
                "Возможно-ли устроиться к вам?",
                "Можно-ли мне поработать у вас?",
                "Хочу работать редактором у вас"
            ],
            "answer": "Если вы хотите устроиться к нам, напишите на почту game-of-verbs@gmail.com мини-эссе о себе и прикрепите ваше портфолио."
        },
        "Забыл пароль": {
            "questions": [
                "Не помню пароль",
                "Не могу войти",
                "Проблемы со входом",
                "Забыл пароль",
                "Забыл логин",
                "Восстановить пароль",
                "Как восстановить пароль",
                "Неправильный логин или пароль",
                "Ошибка входа",
                "Не могу войти в аккаунт"
            ],
            "answer": "Если вы не можете войти на сайт, воспользуйтесь кнопкой «Забыли пароль?» под формой входа. Вам на почту прийдёт письмо с дальнейшими инструкциями. Проверьте папку «Спам», иногда письма попадают в неё."
        },
    }
    ```
    После загрузки файла перейдите на страницу настроек агента и на закладке `ML Settings` запустите процесс обучения нажав кнопку TRAIN:
![image](https://user-images.githubusercontent.com/22379662/184509359-00d0fac8-e90b-43a0-8b96-9e3e2d91d890.png)

1. Запустите ВК-бота командой:
    ```
    python vk_bot.py
    ```
1. Запустите Телеграм-бота командой:
    ```
    python tg_bot.py
    ```


## Цели проекта

Код написан в учебных целях — это урок в курсе по Python и веб-разработке на сайте [Devman](https://dvmn.org).
